<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			rel="icon"
			href="https://cdn.pixabay.com/photo/2012/04/18/00/20/globe-36242_640.png"
		/>
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<title>U r here</title>
	</head>
	<body>
		<div id="nav-bar">Detect Cheating</div>
		<div class="content">
			<div id="log-times">
				Số lần bạn thoát khỏi trang này:<span class="cnt">0</span>
			</div>
			<div id="history">
				Lịch sử thoát trang:
				<div class="container"></div>
			</div>
		</div>
		<div class="clear-btn"></div>

		<script>
			const $ = document.querySelector.bind(document);
			const $$ = document.querySelectorAll.bind(document);

			$('#nav-bar').addEventListener('mousedown', (e) => {
				document.body.classList.toggle('dark');
			});

			function magicMouse(e) {
				var to_append = $$('.loader-container')[0];
				var all = $$('.loader-container');

				var parent_div = document.createElement('div');
				parent_div.className = 'loader-container';

				var inner_div = document.createElement('div');
				inner_div.className = 'loader';
				parent_div.appendChild(inner_div);
				var d = document.body.appendChild(parent_div);

				parent_div.style.left = e.clientX - 50 + 'px';
				parent_div.style.top = e.clientY - 50 + 'px';

				if ($$('.loader-container').length > 30)
					document.body.removeChild(to_append);
			}
			$('.content').addEventListener('mousemove', (e) => magicMouse(e));

			var historyTrack = localStorage.getItem('historyTrack')
				? JSON.parse(localStorage.getItem('historyTrack'))
				: '';
			var cnt = JSON.parse(localStorage.getItem('history')) || 0;
			$('.container').innerHTML = historyTrack;
			$('.cnt').innerHTML = cnt;

			$('.clear-btn').addEventListener('click', () => {
				localStorage.setItem('historyTrack', '');
				localStorage.setItem('history', '0');
				$('.container').innerHTML = '';
				$('.cnt').innerHTML = cnt = 0;
			});

			document.addEventListener('visibilitychange', () => {
				if (document.hidden) {
					document.title = 'U r away';
					$('.cnt').innerHTML = ++cnt;

					var today = new Date();
					var time =
						today.getHours() +
						'h ' +
						today.getMinutes() +
						'min ' +
						today.getSeconds() +
						's';

					$('.container').innerHTML =
						`<p>
							<span style="color: var(--color2)">${cnt}/</span> ${time}</p>` +
						$('.container').innerHTML;

					localStorage.setItem(
						'history',
						JSON.stringify($('.cnt').innerHTML)
					);
					localStorage.setItem(
						'historyTrack',
						JSON.stringify($('.container').innerHTML)
					);
				} else document.title = 'U r here';
			});
		</script>
	</body>
</html>
